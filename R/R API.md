# 1. 주요 API 활용

## 1) 날짜, 시간 관련 함수

R에서 날짜와 시간을 나타낼 때 쓰이는 클래스는 3가지가 존재한다.

* `Date` : **날짜**를 나타낸다. (내부적으로 1970년 1월 1일 이후 경과된 일 수를 저장)
* `POSIXct` : **날짜와 시간**을 나타낸다. (내부적으로 1970년 1월 1일 이후 경과된 초 수와 타임존을 저장)
* `POSIXlt` : **날짜와 시간**을 나타낸다. (내부적으로 1900년에서 경과된 년 수, 월, 일, 시간, 분, 초, 타임존 등을 리스트의 형태로 저장한다.)



`Sys`의 경우에는 대문자로 시작하는 것에 유의한다.

- 현재날짜: `Sys.Date()`

- 현재날짜 및 시간: `Sys.time()`

- 미국식 날짜 및 시간: `date()`

 ```R
today <- Sys.Date() #연월일 정보의 date 타입
[1] "2021-03-02" 



Sys.Date() # 연월일
Sys.time() # 연월일 시분초
str(Sys.time())
Sys.timezone() 
 ```



### (1) 문자열을 시간  변경 및 포맷팅

**년 - 월 - 일 시 : 분 : 초 **타입의 문자열을 시간으로 변환해준다.

`as.Date("년-월-일 시:분:초")` 또는 `as.Date("년/월/일 시:분:초")`

이 규격을 따르지 않는다면,  `format` 매개변수를 이용한다.

`as.Date("날짜 및 시간 문자열", format="포맷")`

|         %d          |    %a     |     %A      |       % m       |
| :-----------------: | :-------: | :---------: | :-------------: |
| 1-31일을 두자리수로 | 축약 요일 | 풀네임 요일 | 월을 두자리수로 |
|       **%b**        |  **%B**   |   **%y**    |     **%Y**      |
|       축약 월       | 풀네임 월 | 두자리 연도 |   네자리 연도   |

```R
format(today, "%d %B %Y")

as.Date('1/15/2018',format='%m/%d/%Y')

as.Date('4월 26, 2018',format='%B %d, %Y')

as.Date('22118',format='%d%b%y') 
```



### (2) 날짜 데이터의 연산

날짜 데이터 끼리 연산이 가능하다.

날짜끼리 뺄셈 가능, 날짜와 정수의 덧셈 뺄셈 가능 (하루를 1로 간주, 소숫점 생략)

날짜 데이터끼리 연산할 때 소숫점을 표현하고자 하는 경우는 `as.Date` 대신에 `as.POSIXct` 함수를 이용

```R
as.Date("2018/01/01 08:00:00") - as.Date("2018/01/01 05:00:00")

as.POSIXct("2018/01/01 08:00:00") - as.POSIXct("2018/01/01 05:00:00")

as.POSIXlt("2018/01/01 08:00:00") - as.POSIXlt("2018/01/01 05:00:00")
```



### (3) weekdays(), months(), quarters()

각각 해당하는 날짜의 요일/월/분기에 대한 정보를 알려준다.

```R
weekdays(today)
months(today)
quarters(today)
```



### (4) unclass()

객체 상태를 해제해주는 함수인데,

아규먼트로 date 객체를 넣을 경우에는 1970-01-01을 기준으로 얼마나 날짜가 지났지는 지의 값을 수치 데이터로 보여준다. 

```R
unclass(today) 
# 1970-01-01을 기준으로 얼마나 날짜가 지났는지의 값을 가지고 있다.

t<-Sys.time()
str(t)
ct<-as.POSIXct(t)
lt<-as.POSIXlt(t)

unclass(ct) 
[1] 1614672426

unclass(lt)
$sec
[1] 5.682848

$min
[1] 7

$hour
[1] 17

$mday
[1] 2

$mon
[1] 2

$year
[1] 121

$wday
[1] 2

$yday
[1] 60

$isdst
[1] 0

$zone
[1] "KST"

$gmtoff
[1] 32400

attr(,"tzone")
[1] ""    "KST" "KDT"
```









## 2) 정규표현식 (Regular Expression)

특정한 규칙을 가진 문자열의 집합을 표현하는데 사용하는 형식 언어

ABCDEFG.......Z → [A-Z]

가각갂간.........힣 → [가-힣]

0123456789 → [0-9]

010-1234-5678 → [0-9]{3}-[0-9]{4}-[0-9]{4} 

A*B → AB,AAB,AAAAAAB,B ..................



```R
 word <- "JAVA javascript 가나다 123 %^&*"
 gsub("A", "", word) 
 gsub("a", "", word) 
 gsub("[Aa]", "", word) 
 gsub("[가-힣]", "", word) 
 gsub("[^가-힣]", "", word) 
 gsub("[&^%*]", "", word) 
 gsub("[[:punct:]]", "", word) 
 gsub("[[:alnum:]]", "", word) 
 gsub("[1234567890]", "", word) 
 gsub("[[:digit:]]", "", word) 
 gsub("[^[:alnum:]]", "", word) 
 gsub("[[:space:]]", "", word) 
 gsub("[[:space:][:punct:]]", "", word

```







```
당신의 믿음은 곧 당신의 생각이 되고, 당신의 생각은 곧 당신이 내뱉는 말이 되고, 당신이 내뱉는 말은 곧 당신의 행동이 되고, 당신의 행동은 곧 당신의 습관이 되고, 당신의 습관은 곧 당신의 가치관이 되고, 당신의 가치관은 곧 당신의 운명이 된다.
중요한 일을 절대 E메일로 보내지 마라!
가장 훌륭한 일은 모험과 도전정신으로 이루어진다.
남들이 나와 같지 않다는 점을 인정하라.
매일 아침 삶의 목표를 생각하며 일어나라.
위대한일을하는유일한방법은바로당신이하는일을사랑하는것입니다.
you 타협(정착)하지 마세요. 왜냐하면, 당신의 마음이 하는 모든 것이 그렇듯이, 그 일을 찾게 되면 당신은 마음으로 알게 될 겁니다. ok?

```





## 3) 문자열 처리 함수



`grep`,`gsub`은 **첫번째 아규먼트**로 `정규표현식`을 쓸 수 있다.



### (1) gsub()

`gsub("찾을 문자열","대체 문자열","대상문자열")`

찾을 문자열 부분에 정규표현식을 사용할 수 있다.



대체 문자열 NULL은 삭제를 의미함

조건에 맞는 것을 찾을 때마다 대체



### (2) sub()

대체를 한번만

`sub("찾을 문자열","대체 문자열","대상문자열")`



### (3) nchar()

### (4) sort()

### (5) tolower()

### (6) toupper()

### (7) substr()

 

### (8) substring()

### (9) grep()

gsub()

### (10) strsplit()





## 4) apply 계열 함수

R에는 **벡터, 행렬 또는 데이터 프레임**에 **임의의 함수**를 적용한 결과를 얻기 위한 **apply 계열 함수**가 있다. 이 함수들은 데이터 전체에 함수를 한 번에 적용하는 벡터 연산을 수행하므로 속도도 빠르고 구현도 간단하다. 

|   **함수**   | **설명**                                                     | **특징**                                           |
| :----------: | :----------------------------------------------------------- | -------------------------------------------------- |
| **apply()**  | 배열 또는 행렬에 주어진 함수를 적용한 뒤 그 결과를 벡터, 배열 또는 리스트로 반환 | 배열/행렬에 적용                                   |
| **lapply()** | 벡터, 리스트 또는 표현식에 함수를 적용하여 그 결과를 리스트로 반환 | 결과가 리스트                                      |
| **sapply()** | lapply와 유사하나 결과를 가능한 심플한 데이터셋으로 반환     | 결과가 심플데이터셋                                |
| **tapply()** | 벡터에 있는 데이터를 특정 기준에 따라 그룹으로 묶은 뒤 각 그룹마다 주어진 함수를 적용하고 그 결과를 반환 | 데이터를 그룹으로 묶은 뒤 함수를 적용              |
| **mapply()** | sapply의 확장된 버전으로, 여러 개의 벡터 또는 리스트를 인자로 받아 함수에 각 데이터의 첫째 요소들을 적용한 결과, 둘째 요소들을 적용한 결과, 셋째 요소들을 적용한 결과 등을 반환 | 여러 데이터셋의 데이터를 함수의 인자로 적용한 결과 |

 

apply( )는 행렬의 행 또는 열 방향으로 특정 함수를 적용하는 데 사용한다.

apply : 배열 또는 행렬에 함수 FUN을 MARGIN 방향으로 적용하여 결과를 벡터, 배열 또는 리스트로 반환한다.

```R
apply(

 X,    # 배열 또는 행렬
 MARGIN, # 함수를 적용하는 방향. 1은 행 방향, 2는 열 방향
 FUN   # 적용할 함수

)
```





 

반환 값은 FUN이 길이 1인 벡터들을 반환한 경우 벡터, 1보다 큰 벡터들을 반환한 경우 행렬, 서로 다른 길이의 벡터를 반환한 경우 리스트다. apply( )가 적용된 결과가 벡터, 배열, 리스트 중 어떤 형태로 반환될 것인지는 데이터 X의 데이터 타입과 함수 FUN의 반환 값에 따라 대부분 자연스럽게 예상할 수 있다. 다음은 합을 구하는 함수 sum( )을 apply( )에 적용하는 예이다. 

\> d <- matrix(1:9, ncol=3)

\> d

\> apply(d, 1, sum)

[1] 12 15 18

\> apply(d, 2, sum)

[1] 6 15 24

 





